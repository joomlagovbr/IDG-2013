!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror"),require("../../mode/sql/sql")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../../mode/sql/sql"],a):a(CodeMirror)}(function(a){"use strict";function b(a){return"[object Array]"==Object.prototype.toString.call(a)}function c(b){var c=b.doc.modeOption;return"sql"===c&&(c="text/x-sql"),a.resolveMode(c).keywords}function d(a){return"string"==typeof a?a:a.text}function e(a,c){return b(c)&&(c={columns:c}),c.text||(c.text=a),c}function f(a){var c={};if(b(a))for(var f=a.length-1;f>=0;f--){var g=a[f];c[d(g).toUpperCase()]=e(d(g),g)}else if(a)for(var h in a)c[h.toUpperCase()]=e(h,a[h]);return c}function g(a){return p[a.toUpperCase()]}function h(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function i(a,b){var c=a.length,e=d(b).substr(0,c);return a.toUpperCase()===e.toUpperCase()}function j(a,c,d,e){if(b(d))for(var f=0;f<d.length;f++)i(c,d[f])&&a.push(e(d[f]));else for(var g in d)if(d.hasOwnProperty(g)){var h=d[g];h=h&&h!==!0?h.displayText?{text:h.text,displayText:h.displayText}:h.text:g,i(c,h)&&a.push(e(h))}}function k(a){return"."==a.charAt(0)&&(a=a.substr(1)),a.replace(/`/g,"")}function l(a){for(var b=d(a).split("."),c=0;c<b.length;c++)b[c]="`"+b[c]+"`";var e=b.join(".");return"string"==typeof a?e:(a=h(a),a.text=e,a)}function m(a,b,c,d){for(var e=!1,f=[],i=b.start,m=!0;m;)m="."==b.string.charAt(0),e=e||"`"==b.string.charAt(0),i=b.start,f.unshift(k(b.string)),b=d.getTokenAt(t(a.line,b.start)),"."==b.string&&(m=!0,b=d.getTokenAt(t(a.line,b.start)));var n=f.join(".");j(c,n,p,function(a){return e?l(a):a}),j(c,n,q,function(a){return e?l(a):a}),n=f.pop();var r=f.join("."),s=!1,u=r;if(!g(r)){var v=r;r=o(r,d),r!==v&&(s=!0)}var w=g(r);return w&&w.columns&&(w=w.columns),w&&j(c,n,w,function(a){var b=r;return 1==s&&(b=u),"string"==typeof a?a=b+"."+a:(a=h(a),a.text=b+"."+a.text),e?l(a):a}),i}function n(a,b){if(a)for(var c=/[,;]/g,d=a.split(" "),e=0;e<d.length;e++)b(d[e]?d[e].replace(c,""):"")}function o(a,b){for(var c=b.doc,d=c.getValue(),e=a.toUpperCase(),f="",h="",i=[],j={start:t(0,0),end:t(b.lastLine(),b.getLineHandle(b.lastLine()).length)},k=d.indexOf(s.QUERY_DIV);-1!=k;)i.push(c.posFromIndex(k)),k=d.indexOf(s.QUERY_DIV,k+1);i.unshift(t(0,0)),i.push(t(b.lastLine(),b.getLineHandle(b.lastLine()).text.length));for(var l=null,m=b.getCursor(),o=0;o<i.length;o++){if((null==l||u(m,l)>0)&&u(m,i[o])<=0){j={start:l,end:i[o]};break}l=i[o]}for(var p=c.getRange(j.start,j.end,!1),o=0;o<p.length;o++){var q=p[o];if(n(q,function(a){var b=a.toUpperCase();b===e&&g(f)&&(h=f),b!==s.ALIAS_KEYWORD&&(f=a)}),h)break}return h}var p,q,r,s={QUERY_DIV:";",ALIAS_KEYWORD:"AS"},t=a.Pos,u=a.cmpPos;a.registerHelper("hint","sql",function(a,b){p=f(b&&b.tables);var d=b&&b.defaultTable,e=b&&b.disableKeywords;q=d&&g(d),r=c(a),d&&!q&&(q=o(d,a)),q=q||[],q.columns&&(q=q.columns);var h,i,k,l=a.getCursor(),n=[],s=a.getTokenAt(l);return s.end>l.ch&&(s.end=l.ch,s.string=s.string.slice(0,l.ch-s.start)),s.string.match(/^[.`\w@]\w*$/)?(k=s.string,h=s.start,i=s.end):(h=i=l.ch,k=""),"."==k.charAt(0)||"`"==k.charAt(0)?h=m(l,s,n,a):(j(n,k,p,function(a){return a}),j(n,k,q,function(a){return a}),e||j(n,k,r,function(a){return a.toUpperCase()})),{list:n,from:t(l.line,h),to:t(l.line,i)}})});