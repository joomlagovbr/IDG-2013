!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){"use strict";function b(a){var b=a.search(e);return-1==b?0:b}function c(a,b,c){return/\bstring\b/.test(a.getTokenTypeAt(f(b.line,0)))&&!/^[\'\"`]/.test(c)}var d={},e=/[^\s\u00a0]/,f=a.Pos;a.commands.toggleComment=function(a){a.toggleComment()},a.defineExtension("toggleComment",function(a){a||(a=d);for(var b=this,c=1/0,e=this.listSelections(),g=null,h=e.length-1;h>=0;h--){var i=e[h].from(),j=e[h].to();i.line>=c||(j.line>=c&&(j=f(c,0)),c=i.line,null==g?b.uncomment(i,j,a)?g="un":(b.lineComment(i,j,a),g="line"):"un"==g?b.uncomment(i,j,a):b.lineComment(i,j,a))}}),a.defineExtension("lineComment",function(a,g,h){h||(h=d);var i=this,j=i.getModeAt(a),k=i.getLine(a.line);if(null!=k&&!c(i,a,k)){var l=h.lineComment||j.lineComment;if(!l)return void((h.blockCommentStart||j.blockCommentStart)&&(h.fullLines=!0,i.blockComment(a,g,h)));var m=Math.min(0!=g.ch||g.line==a.line?g.line+1:g.line,i.lastLine()+1),n=null==h.padding?" ":h.padding,o=h.commentBlankLines||a.line==g.line;i.operation(function(){if(h.indent){for(var c=null,d=a.line;m>d;++d){var g=i.getLine(d),j=g.slice(0,b(g));(null==c||c.length>j.length)&&(c=j)}for(var d=a.line;m>d;++d){var g=i.getLine(d),k=c.length;(o||e.test(g))&&(g.slice(0,k)!=c&&(k=b(g)),i.replaceRange(c+l+n,f(d,0),f(d,k)))}}else for(var d=a.line;m>d;++d)(o||e.test(i.getLine(d)))&&i.replaceRange(l+n,f(d,0))})}}),a.defineExtension("blockComment",function(a,b,c){c||(c=d);var g=this,h=g.getModeAt(a),i=c.blockCommentStart||h.blockCommentStart,j=c.blockCommentEnd||h.blockCommentEnd;if(!i||!j)return void((c.lineComment||h.lineComment)&&0!=c.fullLines&&g.lineComment(a,b,c));var k=Math.min(b.line,g.lastLine());k!=a.line&&0==b.ch&&e.test(g.getLine(k))&&--k;var l=null==c.padding?" ":c.padding;a.line>k||g.operation(function(){if(0!=c.fullLines){var d=e.test(g.getLine(k));g.replaceRange(l+j,f(k)),g.replaceRange(i+l,f(a.line,0));var m=c.blockCommentLead||h.blockCommentLead;if(null!=m)for(var n=a.line+1;k>=n;++n)(n!=k||d)&&g.replaceRange(m+l,f(n,0))}else g.replaceRange(j,b),g.replaceRange(i,a)})}),a.defineExtension("uncomment",function(a,b,c){c||(c=d);var g,h=this,i=h.getModeAt(a),j=Math.min(0!=b.ch||b.line==a.line?b.line:b.line-1,h.lastLine()),k=Math.min(a.line,j),l=c.lineComment||i.lineComment,m=[],n=null==c.padding?" ":c.padding;a:if(l){for(var o=k;j>=o;++o){var p=h.getLine(o),q=p.indexOf(l);if(q>-1&&!/comment/.test(h.getTokenTypeAt(f(o,q+1)))&&(q=-1),-1==q&&(o!=j||o==k)&&e.test(p))break a;if(q>-1&&e.test(p.slice(0,q)))break a;m.push(p)}if(h.operation(function(){for(var a=k;j>=a;++a){var b=m[a-k],c=b.indexOf(l),d=c+l.length;0>c||(b.slice(d,d+n.length)==n&&(d+=n.length),g=!0,h.replaceRange("",f(a,c),f(a,d)))}}),g)return!0}var r=c.blockCommentStart||i.blockCommentStart,s=c.blockCommentEnd||i.blockCommentEnd;if(!r||!s)return!1;var t=c.blockCommentLead||i.blockCommentLead,u=h.getLine(k),v=j==k?u:h.getLine(j),w=u.indexOf(r),x=v.lastIndexOf(s);if(-1==x&&k!=j&&(v=h.getLine(--j),x=v.lastIndexOf(s)),-1==w||-1==x||!/comment/.test(h.getTokenTypeAt(f(k,w+1)))||!/comment/.test(h.getTokenTypeAt(f(j,x+1))))return!1;var y=u.lastIndexOf(r,a.ch),z=-1==y?-1:u.slice(0,a.ch).indexOf(s,y+r.length);if(-1!=y&&-1!=z&&z+s.length!=a.ch)return!1;z=v.indexOf(s,b.ch);var A=v.slice(b.ch).lastIndexOf(r,z-b.ch);return y=-1==z||-1==A?-1:b.ch+A,-1!=z&&-1!=y&&y!=b.ch?!1:(h.operation(function(){h.replaceRange("",f(j,x-(n&&v.slice(x-n.length,x)==n?n.length:0)),f(j,x+s.length));var a=w+r.length;if(n&&u.slice(a,a+n.length)==n&&(a+=n.length),h.replaceRange("",f(k,w),f(k,a)),t)for(var b=k+1;j>=b;++b){var c=h.getLine(b),d=c.indexOf(t);if(-1!=d&&!e.test(c.slice(0,d))){var g=d+t.length;n&&c.slice(g,g+n.length)==n&&(g+=n.length),h.replaceRange("",f(b,d),f(b,g))}}}),!0)})});