!(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../ruby/ruby")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../htmlmixed/htmlmixed","../ruby/ruby"],a):a(CodeMirror)})((function(a){"use strict";a.defineMode("slim",(function(b){function c(a,b,c){var d=function(d,e){return e.tokenize=b,d.pos<a?(d.pos=a,c):e.tokenize(d,e)};return function(a,c){return c.tokenize=d,b(a,c)}}function d(a,b,d,e,f){var g=a.current(),h=g.search(d);return h>-1&&(b.tokenize=c(a.pos,b.tokenize,f),a.backUp(g.length-h-e)),f}function e(a,b){a.stack={parent:a.stack,style:"continuation",indented:b,tokenize:a.line},a.line=a.tokenize}function f(a){a.line==a.tokenize&&(a.line=a.stack.tokenize,a.stack=a.stack.parent)}function g(a,b){return function(c,d){if(f(d),c.match(/^\\$/))return e(d,a),"lineContinuation";var g=b(c,d);return c.eol()&&c.current().match(/(?:^|[^\\])(?:\\\\)*\\$/)&&c.backUp(1),g}}function h(a,b){return function(c,d){f(d);var g=b(c,d);return c.eol()&&c.current().match(/,$/)&&e(d,a),g}}function i(a,b){return function(c,d){var e=c.peek();return e==a&&1==d.rubyState.tokenize.length?(c.next(),d.tokenize=b,"closeAttributeTag"):k(c,d)}}function j(b){var c,d=function(a,d){if(1==d.rubyState.tokenize.length&&!d.rubyState.context.prev){if(a.backUp(1),a.eatSpace())return d.rubyState=c,d.tokenize=b,b(a,d);a.next()}return k(a,d)};return function(b,e){return c=e.rubyState,e.rubyState=a.startState(N),e.tokenize=d,k(b,e)}}function k(a,b){return N.token(a,b.rubyState)}function l(a,b){return a.match(/^\\$/)?"lineContinuation":m(a,b)}function m(a,b){return a.match(/^#\{/)?(b.tokenize=i("}",b.tokenize),null):d(a,b,/[^\\]#\{/,1,M.token(a,b.htmlState))}function n(a){return function(b,c){var d=l(b,c);return b.eol()&&(c.tokenize=a),d}}function o(a,b,c){return b.stack={parent:b.stack,style:"html",indented:a.column()+c,tokenize:b.line},b.line=b.tokenize=m,null}function p(a,b){return a.skipToEnd(),b.stack.style}function q(a,b){return b.stack={parent:b.stack,style:"comment",indented:b.indented+1,tokenize:b.line},b.line=p,p(a,b)}function r(a,b){return a.eat(b.stack.endQuote)?(b.line=b.stack.line,b.tokenize=b.stack.tokenize,b.stack=b.stack.parent,null):a.match(X)?(b.tokenize=s,"slimAttribute"):(a.next(),null)}function s(a,b){return a.match(/^==?/)?(b.tokenize=t,null):r(a,b)}function t(a,b){var c=a.peek();return'"'==c||"'"==c?(b.tokenize=K(c,"string",!0,!1,r),a.next(),b.tokenize(a,b)):"["==c?j(r)(a,b):a.match(/^(true|false|nil)\b/)?(b.tokenize=r,"keyword"):j(r)(a,b)}function u(a,b,c){return a.stack={parent:a.stack,style:"wrapper",indented:a.indented+1,tokenize:c,line:a.line,endQuote:b},a.line=a.tokenize=r,null}function v(b,c){if(b.match(/^#\{/))return c.tokenize=i("}",c.tokenize),null;var d=new a.StringStream(b.string.slice(c.stack.indented),b.tabSize);d.pos=b.pos-c.stack.indented,d.start=b.start-c.stack.indented,d.lastColumnPos=b.lastColumnPos-c.stack.indented,d.lastColumnValue=b.lastColumnValue-c.stack.indented;var e=c.subMode.token(d,c.subState);return b.pos=d.pos+c.stack.indented,e}function w(a,b){return b.stack.indented=a.column(),b.line=b.tokenize=v,b.tokenize(a,b)}function x(c){var d=P[c],e=a.mimeModes[d];if(e)return a.getMode(b,e);var f=a.modes[d];return f?f(b,{name:d}):a.getMode(b,"null")}function y(a){return O.hasOwnProperty(a)?O[a]:O[a]=x(a)}function z(b,c){var d=y(b),e=a.startState(d);return c.subMode=d,c.subState=e,c.stack={parent:c.stack,style:"sub",indented:c.indented+1,tokenize:c.line},c.line=c.tokenize=w,"slimSubmode"}function A(a,b){return a.skipToEnd(),"slimDoctype"}function B(a,b){var c=a.peek();if("<"==c)return(b.tokenize=n(b.tokenize))(a,b);if(a.match(/^[|']/))return o(a,b,1);if(a.match(/^\/(!|\[\w+])?/))return q(a,b);if(a.match(/^(-|==?[<>]?)/))return b.tokenize=g(a.column(),h(a.column(),k)),"slimSwitch";if(a.match(/^doctype\b/))return b.tokenize=A,"keyword";var d=a.match(Q);return d?z(d[1],b):D(a,b)}function C(a,b){return b.startOfLine?B(a,b):D(a,b)}function D(a,b){return a.eat("*")?(b.tokenize=j(E),null):a.match(V)?(b.tokenize=E,"slimTag"):F(a,b)}function E(a,b){return a.match(/^(<>?|><?)/)?(b.tokenize=F,null):F(a,b)}function F(a,b){return a.match(Z)?(b.tokenize=F,"slimId"):a.match(Y)?(b.tokenize=F,"slimClass"):G(a,b)}function G(a,b){return a.match(/^([\[\{\(])/)?u(b,S[RegExp.$1],G):a.match(W)?(b.tokenize=H,"slimAttribute"):"*"==a.peek()?(a.next(),b.tokenize=j(L),null):L(a,b)}function H(a,b){return a.match(/^==?/)?(b.tokenize=I,null):G(a,b)}function I(a,b){var c=a.peek();return'"'==c||"'"==c?(b.tokenize=K(c,"string",!0,!1,G),a.next(),b.tokenize(a,b)):"["==c?j(G)(a,b):":"==c?j(J)(a,b):a.match(/^(true|false|nil)\b/)?(b.tokenize=G,"keyword"):j(G)(a,b)}function J(a,b){return a.backUp(1),a.match(/^[^\s],(?=:)/)?(b.tokenize=j(J),null):(a.next(),G(a,b))}function K(a,b,c,d,g){return function(h,j){f(j);var k=0==h.current().length;if(h.match(/^\\$/,k))return k?(e(j,j.indented),"lineContinuation"):b;if(h.match(/^#\{/,k))return k?(j.tokenize=i("}",j.tokenize),null):b;for(var l,m=!1;null!=(l=h.next());){if(l==a&&(d||!m)){j.tokenize=g;break}if(c&&"#"==l&&!m&&h.eat("{")){h.backUp(2);break}m=!m&&"\\"==l}return h.eol()&&m&&h.backUp(1),b}}function L(a,b){return a.match(/^==?/)?(b.tokenize=k,"slimSwitch"):a.match(/^\/$/)?(b.tokenize=C,null):a.match(/^:/)?(b.tokenize=D,"slimSwitch"):(o(a,b,0),b.tokenize(a,b))}var M=a.getMode(b,{name:"htmlmixed"}),N=a.getMode(b,"ruby"),O={html:M,ruby:N},P={ruby:"ruby",javascript:"javascript",css:"text/css",sass:"text/x-sass",scss:"text/x-scss",less:"text/x-less",styl:"text/x-styl",coffee:"coffeescript",asciidoc:"text/x-asciidoc",markdown:"text/x-markdown",textile:"text/x-textile",creole:"text/x-creole",wiki:"text/x-wiki",mediawiki:"text/x-mediawiki",rdoc:"text/x-rdoc",builder:"text/x-builder",nokogiri:"text/x-nokogiri",erb:"application/x-erb"},Q=(function(a){var b=[];for(var c in a)b.push(c);return new RegExp("^("+b.join("|")+"):")})(P),R={commentLine:"comment",slimSwitch:"operator special",slimTag:"tag",slimId:"attribute def",slimClass:"attribute qualifier",slimAttribute:"attribute",slimSubmode:"keyword special",closeAttributeTag:null,slimDoctype:null,lineContinuation:null},S={"{":"}","[":"]","(":")"},T="_a-zA-ZÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�",U=T+"\\-0-9·̀-ͯ‿-⁀",V=new RegExp("^[:"+T+"](?::["+U+"]|["+U+"]*)"),W=new RegExp("^[:"+T+"][:\\."+U+"]*(?=\\s*=)"),X=new RegExp("^[:"+T+"][:\\."+U+"]*"),Y=/^\.-?[_a-zA-Z]+[\w\-]*/,Z=/^#[_a-zA-Z]+[\w\-]*/,$={startState:function(){var b=a.startState(M),c=a.startState(N);return{htmlState:b,rubyState:c,stack:null,last:null,tokenize:C,line:C,indented:0}},copyState:function(b){return{htmlState:a.copyState(M,b.htmlState),rubyState:a.copyState(N,b.rubyState),subMode:b.subMode,subState:b.subMode&&a.copyState(b.subMode,b.subState),stack:b.stack,last:b.last,tokenize:b.tokenize,line:b.line}},token:function(a,b){if(a.sol())for(b.indented=a.indentation(),b.startOfLine=!0,b.tokenize=b.line;b.stack&&b.stack.indented>b.indented&&"slimSubmode"!=b.last;)b.line=b.tokenize=b.stack.tokenize,b.stack=b.stack.parent,b.subMode=null,b.subState=null;if(a.eatSpace())return null;var c=b.tokenize(a,b);return b.startOfLine=!1,c&&(b.last=c),R.hasOwnProperty(c)?R[c]:c},blankLine:function(a){if(a.subMode&&a.subMode.blankLine)return a.subMode.blankLine(a.subState)},innerMode:function(a){return a.subMode?{state:a.subState,mode:a.subMode}:{state:a,mode:$}}};return $}),"htmlmixed","ruby"),a.defineMIME("text/x-slim","slim"),a.defineMIME("application/x-slim","slim")}));