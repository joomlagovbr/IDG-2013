!(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)})((function(a){"use strict";a.defineMode("velocity",(function(){function a(a){for(var b={},c=a.split(" "),d=0;d<c.length;++d)b[c[d]]=!0;return b}function b(a,b,c){return b.tokenize=c,c(a,b)}function c(a,c){var k=c.beforeParams;c.beforeParams=!1;var l=a.next();if("'"==l&&!c.inString&&c.inParams)return c.lastTokenWasBuiltin=!1,b(a,c,d(l));if('"'!=l){if(/[\[\]{}\(\),;\.]/.test(l))return"("==l&&k?c.inParams=!0:")"==l&&(c.inParams=!1,c.lastTokenWasBuiltin=!0),null;if(/\d/.test(l))return c.lastTokenWasBuiltin=!1,a.eatWhile(/[\w\.]/),"number";if("#"==l&&a.eat("*"))return c.lastTokenWasBuiltin=!1,b(a,c,e);if("#"==l&&a.match(/ *\[ *\[/))return c.lastTokenWasBuiltin=!1,b(a,c,f);if("#"==l&&a.eat("#"))return c.lastTokenWasBuiltin=!1,a.skipToEnd(),"comment";if("$"==l)return a.eatWhile(/[\w\d\$_\.{}]/),i&&i.propertyIsEnumerable(a.current())?"keyword":(c.lastTokenWasBuiltin=!0,c.beforeParams=!0,"builtin");if(j.test(l))return c.lastTokenWasBuiltin=!1,a.eatWhile(j),"operator";a.eatWhile(/[\w\$_{}@]/);var m=a.current();return g&&g.propertyIsEnumerable(m)?"keyword":h&&h.propertyIsEnumerable(m)||a.current().match(/^#@?[a-z0-9_]+ *$/i)&&"("==a.peek()&&(!h||!h.propertyIsEnumerable(m.toLowerCase()))?(c.beforeParams=!0,c.lastTokenWasBuiltin=!1,"keyword"):c.inString?(c.lastTokenWasBuiltin=!1,"string"):a.pos>m.length&&"."==a.string.charAt(a.pos-m.length-1)&&c.lastTokenWasBuiltin?"builtin":(c.lastTokenWasBuiltin=!1,null)}return c.lastTokenWasBuiltin=!1,c.inString?(c.inString=!1,"string"):c.inParams?b(a,c,d(l)):void 0}function d(a){return function(b,d){for(var e,f=!1,g=!1;null!=(e=b.next());){if(e==a&&!f){g=!0;break}if('"'==a&&"$"==b.peek()&&!f){d.inString=!0,g=!0;break}f=!f&&"\\"==e}return g&&(d.tokenize=c),"string"}}function e(a,b){for(var d,e=!1;d=a.next();){if("#"==d&&e){b.tokenize=c;break}e="*"==d}return"comment"}function f(a,b){for(var d,e=0;d=a.next();){if("#"==d&&2==e){b.tokenize=c;break}"]"==d?e++:" "!=d&&(e=0)}return"meta"}var g=a("#end #else #break #stop #[[ #]] #{end} #{else} #{break} #{stop}"),h=a("#if #elseif #foreach #set #include #parse #macro #define #evaluate #{if} #{elseif} #{foreach} #{set} #{include} #{parse} #{macro} #{define} #{evaluate}"),i=a("$foreach.count $foreach.hasNext $foreach.first $foreach.last $foreach.topmost $foreach.parent.count $foreach.parent.hasNext $foreach.parent.first $foreach.parent.last $foreach.parent $velocityCount $!bodyContent $bodyContent"),j=/[+\-*&%=<>!?:\/|]/;return{startState:function(){return{tokenize:c,beforeParams:!1,inParams:!1,inString:!1,lastTokenWasBuiltin:!1}},token:function(a,b){return a.eatSpace()?null:b.tokenize(a,b)},blockCommentStart:"#*",blockCommentEnd:"*#",lineComment:"##",fold:"velocity"}})),a.defineMIME("text/velocity","velocity")}));