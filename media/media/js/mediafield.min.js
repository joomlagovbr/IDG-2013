function jInsertFieldValue(t,e){var i=jQuery.noConflict();if(i("#"+e).val()!=t){var o=i("#"+e);o.val(t),o.trigger("change"),"function"==typeof o.get(0).onchange&&o.get(0).onchange(),jMediaRefreshPreview(e)}}function jMediaRefreshPreview(t){var e=jQuery.noConflict(),i=e("#"+t).val(),o=e("#"+t+"_preview"),n=e("#"+t).data("basepath");o.length&&(i?(o.attr("src",n+i),e("#"+t+"_preview_empty").hide(),e("#"+t+"_preview_img").show()):(o.attr("src",""),e("#"+t+"_preview_empty").show(),e("#"+t+"_preview_img").hide()))}function jMediaRefreshPreviewTip(t){var o=jQuery.noConflict(),n=o(t);n.find("img.media-preview").each((function(t,e){n.find("div.tip").css("max-width","none");var i=o(this).attr("id");jMediaRefreshPreview(i=i.substring(0,i.length-"_preview".length)),n.show(this)}))}function jMediaRefreshImgpathTip(t,e){var i=jQuery.noConflict(),o=i(t);o.css("max-width","none");var n=i(e).val();i("#TipImgpath").html(n),n.length?o.show():o.hide()}!(function(a){"use strict";Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");function e(){}function i(){return n.apply(this instanceof e&&t?this:t,o.concat(Array.prototype.slice.call(arguments)))}var o=Array.prototype.slice.call(arguments,1),n=this;return e.prototype=this.prototype,i.prototype=new e,i}),a.fieldMedia=function(t,e){this.options=a.extend({},a.fieldMedia.defaults,e),this.$container=a(t),this.$modal=this.$container.find(this.options.modal),this.$modalBody=this.$modal.children(".modal-body"),this.$input=this.$container.find(this.options.input),this.$containerPreview=this.$container.find(this.options.previewContainer),this.$buttonSelect=this.$container.find(this.options.buttonSelect),this.$buttonClear=this.$container.find(this.options.buttonClear),this.$buttonSelect.on("click",this.modalOpen.bind(this)),this.$buttonClear.on("click",this.clearValue.bind(this)),this.$modal.on("hide",this.removeIframe.bind(this)),this.updatePreview()},a.fieldMedia.prototype.modalOpen=function(){var t=a("<iframe>",{name:"field-media-modal",src:this.options.url.replace("{field-media-id}",this.$input.attr("id")),width:this.options.modalWidth,height:this.options.modalHeight});this.$modalBody.append(t),this.$modal.modal("show"),a("body").addClass("modal-open");var i=this;t.load((function(){var e=a(this).contents();e.on("click",i.options.buttonSaveSelected,(function(){var t=e.find("#f_url").val();t&&i.setValue(t),i.modalClose.call(i)})),e.on("click",".button-cancel",(function(){a("body").removeClass("modal-open"),i.modalClose.bind(i)}))}))},a.fieldMedia.prototype.modalClose=function(){this.$modal.modal("hide"),a("body").removeClass("modal-open"),this.$modalBody.empty()},a.fieldMedia.prototype.removeIframe=function(){this.$modalBody.empty(),a("body").removeClass("modal-open")},a.fieldMedia.prototype.setValue=function(t){this.$input.val(t).trigger("change"),this.updatePreview()},a.fieldMedia.prototype.clearValue=function(){this.setValue("")},a.fieldMedia.prototype.updatePreview=function(){if(this.options.preview)if(this.options.preview&&!this.options.previewAsTooltip){if(t=this.$input.val())(e=new Image).src=this.options.basepath+t,e.width>e.height?this.$containerPreview.html(a("<img>",{src:e.src,style:"width: "+this.options.previewWidth+"px"})):this.$containerPreview.html(a("<img>",{src:e.src,style:"height: "+this.options.previewHeight+"px"}));else this.$containerPreview.append("")}else{try{this.$containerPreview.popover("destroy"),this.$input.tooltip("destroy")}catch(t){}var t,e;if(t=this.$input.val())(e=new Image(this.options.previewWidth,this.options.previewHeight)).src=this.options.basepath+t,this.$containerPreview.popover({content:e}),this.$input.tooltip({placement:"top",title:t,html:!1});else this.$containerPreview.popover()}},a.fieldMedia.defaults={basepath:"",buttonClear:".button-clear",buttonSelect:".button-select",buttonSaveSelected:".button-save-selected",input:".field-media-input",preview:!0,previewAsTooltip:!0,previewContainer:".field-media-preview",previewWidth:200,previewHeight:200,url:"index.php?option=com_media&tmpl=component",modal:".modal",modalWidth:"100%",modalHeight:"300px"},a.fn.fieldMedia=function(t){return this.each((function(){var t=a(this),e=t.data("fieldMedia");if(!e){var i=i||{},o=t.data();for(var n in o)o.hasOwnProperty(n)&&(i[n]=o[n]);e=new a.fieldMedia(this,i),t.data("fieldMedia",e)}}))},a((function(i){function t(t,e){i(e||document).find(".field-media-wrapper").fieldMedia()}t(),i(document).on("subform-row-add",t)}))})(jQuery);

