function jInsertFieldValue(a,b){var c=jQuery.noConflict(),d=c("#"+b).val();if(d!=a){var e=c("#"+b);e.val(a),e.trigger("change"),"function"==typeof e.get(0).onchange&&e.get(0).onchange(),jMediaRefreshPreview(b)}}function jMediaRefreshPreview(a){var b=jQuery.noConflict(),c=b("#"+a).val(),d=b("#"+a+"_preview"),e=b("#"+a).data("basepath");d.length&&(c?(d.attr("src",e+c),b("#"+a+"_preview_empty").hide(),b("#"+a+"_preview_img").show()):(d.attr("src",""),b("#"+a+"_preview_empty").show(),b("#"+a+"_preview_img").hide()))}function jMediaRefreshPreviewTip(a){var b=jQuery.noConflict(),c=b(a),d=c.find("img.media-preview");d.each(function(a,d){c.find("div.tip").css("max-width","none");var e=b(this).attr("id");e=e.substring(0,e.length-"_preview".length),jMediaRefreshPreview(e),c.show(this)})}function jMediaRefreshImgpathTip(a,b){var c=jQuery.noConflict(),d=c(a);d.css("max-width","none");var e=c(b).val();c("#TipImgpath").html(e),e.length?d.show():d.hide()}!function(a){"use strict";Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),a.fieldMedia=function(b,c){this.options=a.extend({},a.fieldMedia.defaults,c),this.$container=a(b),this.$modal=this.$container.find(this.options.modal),this.$modalBody=this.$modal.children(".modal-body"),this.$input=this.$container.find(this.options.input),this.$containerPreview=this.$container.find(this.options.previewContainer),this.$buttonSelect=this.$container.find(this.options.buttonSelect),this.$buttonClear=this.$container.find(this.options.buttonClear),this.$buttonSelect.on("click",this.modalOpen.bind(this)),this.$buttonClear.on("click",this.clearValue.bind(this)),this.$modal.on("hide",this.removeIframe.bind(this)),this.updatePreview()},a.fieldMedia.prototype.modalOpen=function(){var b=a("<iframe>",{name:"field-media-modal",src:this.options.url.replace("{field-media-id}",this.$input.attr("id")),width:this.options.modalWidth,height:this.options.modalHeight});this.$modalBody.append(b),this.$modal.modal("show"),a("body").addClass("modal-open");var c=this;b.load(function(){var b=a(this).contents();b.on("click",c.options.buttonSaveSelected,function(){var a=b.find("#f_url").val();a&&c.setValue(a),c.modalClose.call(c)}),b.on("click",".button-cancel",function(){a("body").removeClass("modal-open"),c.modalClose.bind(c)})})},a.fieldMedia.prototype.modalClose=function(){this.$modal.modal("hide"),a("body").removeClass("modal-open"),this.$modalBody.empty()},a.fieldMedia.prototype.removeIframe=function(){this.$modalBody.empty(),a("body").removeClass("modal-open")},a.fieldMedia.prototype.setValue=function(a){this.$input.val(a).trigger("change"),this.updatePreview()},a.fieldMedia.prototype.clearValue=function(){this.setValue("")},a.fieldMedia.prototype.updatePreview=function(){if(this.options.preview)if(this.options.preview&&!this.options.previewAsTooltip){var b=this.$input.val();if(b){var c=new Image;c.src=this.options.basepath+b,c.width>c.height?this.$containerPreview.html(a("<img>",{src:c.src,style:"width: "+this.options.previewWidth+"px"})):this.$containerPreview.html(a("<img>",{src:c.src,style:"height: "+this.options.previewHeight+"px"}))}else this.$containerPreview.append("")}else{this.$containerPreview.popover("destroy"),this.$input.tooltip("destroy");var b=this.$input.val();if(b){var c=new Image(this.options.previewWidth,this.options.previewHeight);c.src=this.options.basepath+b,this.$containerPreview.popover({content:c}),this.$input.tooltip({placement:"top",title:b})}else this.$containerPreview.popover()}},a.fieldMedia.defaults={basepath:"",buttonClear:".button-clear",buttonSelect:".button-select",buttonSaveSelected:".button-save-selected",input:".field-media-input",preview:!0,previewAsTooltip:!0,previewContainer:".field-media-preview",previewWidth:200,previewHeight:200,url:"index.php?option=com_media&tmpl=component",modal:".modal",modalWidth:"100%",modalHeight:"300px"},a.fn.fieldMedia=function(b){return this.each(function(){var b=a(this),c=b.data("fieldMedia");if(!c){var d=d||{},e=b.data();for(var f in e)e.hasOwnProperty(f)&&(d[f]=e[f]);c=new a.fieldMedia(this,d),b.data("fieldMedia",c)}})},a(document).ready(function(){a(".field-media-wrapper").fieldMedia()})}(jQuery);