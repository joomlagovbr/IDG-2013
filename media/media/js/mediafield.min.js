!function(t){"use strict";t.fieldMedia=function(i,e){this.options=t.extend({},t.fieldMedia.defaults,e),this.$container=t(i),this.$modal=this.$container.find(this.options.modal),this.$modalBody=this.$modal.children(".modal-body"),this.$input=this.$container.find(this.options.input),this.$containerPreview=this.$container.find(this.options.previewContainer),this.$buttonSelect=this.$container.find(this.options.buttonSelect),this.$buttonClear=this.$container.find(this.options.buttonClear),this.$buttonSelect.on("click",this.modalOpen.bind(this)),this.$buttonClear.on("click",this.clearValue.bind(this)),this.$modal.on("hide",this.removeIframe.bind(this)),this.updatePreview()},t.fieldMedia.prototype.modalOpen=function(){var i=t("<iframe>",{name:"field-media-modal",src:this.options.url.replace("{field-media-id}",this.$input.attr("id")),width:this.options.modalWidth,height:this.options.modalHeight});this.$modalBody.append(i),this.$modal.modal("show"),t("body").addClass("modal-open");var e=this;i.load(function(){var i=t(this).contents();i.on("click",e.options.buttonSaveSelected,function(){var t=i.find("#f_url").val();t&&e.setValue(t),e.modalClose.call(e)}),i.on("click",".button-cancel",function(){t("body").removeClass("modal-open"),e.modalClose.bind(e)})})},t.fieldMedia.prototype.modalClose=function(){this.$modal.modal("hide"),t("body").removeClass("modal-open"),this.$modalBody.empty()},t.fieldMedia.prototype.removeIframe=function(){this.$modalBody.empty(),t("body").removeClass("modal-open")},t.fieldMedia.prototype.setValue=function(t){this.$input.val(t).trigger("change"),this.updatePreview()},t.fieldMedia.prototype.clearValue=function(){this.setValue("")},t.fieldMedia.prototype.updatePreview=function(){if(this.options.preview){this.$containerPreview.popover("destroy"),this.$input.tooltip("destroy");var t=this.$input.val();if(t){var i=new Image(this.options.previewWidth,this.options.previewHeight);i.src=this.options.basepath+t,this.$containerPreview.popover({content:i}),this.$input.tooltip({placement:"top",title:t})}else this.$containerPreview.popover()}},t.fieldMedia.defaults={basepath:"",buttonClear:".button-clear",buttonSelect:".button-select",buttonSaveSelected:".button-save-selected",input:".field-media-input",preview:!0,previewContainer:".field-media-preview",previewWidth:200,previewHeight:200,url:"index.php?option=com_media&tmpl=component",modal:".modal",modalWidth:"100%",modalHeight:"300px"},t.fn.fieldMedia=function(){return this.each(function(){var i=t(this),e=i.data("fieldMedia");if(!e){var o=o||{},n=i.data();for(var a in n)n.hasOwnProperty(a)&&(o[a]=n[a]);e=new t.fieldMedia(this,o),i.data("fieldMedia",e)}})},t(document).ready(function(){t(".field-media-wrapper").fieldMedia()})}(jQuery);